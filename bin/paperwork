#!/usr/bin/env node

import PrettyError from 'pretty-error';
import chalk from 'chalk';
import command from '../foundation/console';

process.stdout.write(chalk.green('-'.repeat(120)));
process.stdout.write('\x1B[2J\n\x1B[0f\u001b[0;0H');

const run = async (module, options) => {
  const pretty = new PrettyError();
  const task = typeof module.default === 'undefined' ? module : module.default;

  pretty.start();

  try {
    await task(options);
  } catch (exception) {
    if (exception) {
      // eslint-disable-next-line no-console
      console.error(exception);
    }
  }
};

// eslint-disable-next-line no-underscore-dangle
delete require.cache[__filename];

let name = process.argv[2];

if ( ! name || name.startsWith('--')) {
  name = 'start';
}


switch (name.toLowerCase()) {
  case 'start':
    process.env.NODE_ENV = 'development';
    require('babel-register');

    run(command.start);
    break;
  default:
    if (name in command) {
      run(command[name]);
    } else {
      throw new Error();
    }
}
